<!DOCTYPE html>

<html lang="en">
	<head>
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="shortcut icon" href="metronome.png">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans&display=swap" rel="stylesheet">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>

        <style>
            html, body {
                background-color: #161d20;
                color: #cccccc;
                font-family: 'Josefin Sans', sans-serif;
                display: flex;
                height: 100vh;
                align-items: center;
                justify-content: center;
            }
            .alert {
                position: fixed;
                bottom: 40vh;
            }
            .form-range {
                padding-top: 16px;
            }
            #metronome {
                width: fit-content;
                min-width: 190px;
            }
        </style>
        <script>
            document.addEventListener('DOMContentLoaded', function() {

                let isPlaying = false;
                const startStop = document.querySelector('#start-stop');
                const click = document.querySelector('#click');
                
                let interval;

                const range = document.querySelector('.form-range');
                const input = document.querySelector('#bpm');

                const playMetronome = () => {
                    const input = document.querySelector('#bpm');
                    let bpm = input.value;
                    const alert = document.querySelector('.alert');
                    if (bpm > 300) {
                        bpm = 300;
                        input.value = 300;
                        alert.innerText = 'Too fast! Maximum tempo is 300bpm.';
                        alert.style.display = 'block';
                        setTimeout(() => alert.style.display = 'none', 3000);
                    } else if (bpm < 20) {
                        bpm = 20;
                        input.value = 20;
                        alert.innerText = 'Too slow! Minimum tempo is 20bpm';
                        alert.style.display = 'block';
                        setTimeout(() => alert.style.display = 'none', 3000);
                    }
                    let tempo = 60000 / bpm;
                    if(!isPlaying) {
                        click.play();
                        startStop.innerText = 'Stop';
                        startStop.className = 'btn btn-danger';
                        interval = setInterval(function() {
                            click.currentTime = 0;
                            click.play();
                        }, tempo);
                        isPlaying = true;
                    } else {
                        startStop.innerText = 'Play';
                        startStop.className = 'btn btn-primary';
                        clearInterval(interval);
                        click.pause();
                        click.currentTime = 0;
                        isPlaying = false;
                    }
                }

                function changeTempo(bpm) {
                    input.value = bpm;
                    range.value = bpm;
                    if (isPlaying) {
                        isPlaying = false;
                        clearInterval(interval);
                        playMetronome();
                    }
                }
                
                startStop.onclick = playMetronome;
                
                range.onchange = () => {
                    input.value = range.value;
                    if(isPlaying) {
                        isPlaying = false;
                        clearInterval(interval);
                        playMetronome();
                    }
                }

                input.onchange = () => {
                    range.value = input.value;
                    if(isPlaying) {
                        isPlaying = false;
                        clearInterval(interval);
                        playMetronome();
                    }
                }

                
            })

        </script>
	</head>
	<body>
        <div id="metronome">
            <h1>metronome</h1>
            <div class="input-group">
                <span class="input-group-text">BPM</span>
                <input id="bpm" class="form-control" type="number" min="20" max="300" value="120">
                <button class="btn btn-primary" id="start-stop">Play</button>
            </div>
            <input onchange="changeTempo()" class="form-range" type="range" min="20" max="300" value="120">
        </div>
        <div class="alert alert-warning" style="display: none;"></div>

            <audio id="click" src="metronome.mp3" type="audio.mpeg">
	</body>
</html>